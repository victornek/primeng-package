{"version":3,"sources":["../../src/app/components/chart/chart.ts"],"names":["UIChart","el","this","plugins","responsive","onDataSelect","EventEmitter","_options","Object","defineProperty","prototype","_data","val","reinit","ngAfterViewInit","initChart","initialized","onCanvasClick","event","chart","element","getElementAtEvent","dataset","getDatasetAtEvent","emit","originalEvent","opts","options","height","width","maintainAspectRatio","Chart","nativeElement","children","type","data","getCanvas","getBase64Image","toBase64Image","generateLegend","refresh","update","destroy","ngOnDestroy","Component","args","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","ElementRef","Input","Output","NgModule","imports","CommonModule","exports","declarations"],"mappings":"+uBAoCI,SAAAA,EAAmBC,GAAAC,KAAAD,GAAAA,EAlBVC,KAAAC,QAAiB,GAMjBD,KAAAE,YAAsB,EAErBF,KAAAG,aAAkC,IAAIC,EAAAA,aAMhDJ,KAAAK,SAAgB,UAMhBC,OAAAC,eAAaT,EAAAU,UAAA,OAAI,KAAjB,WACI,OAAOR,KAAKS,WAGhB,SAASC,GACLV,KAAKS,MAAQC,EACbV,KAAKW,0CAGTL,OAAAC,eAAaT,EAAAU,UAAA,UAAO,KAApB,WACI,OAAOR,KAAKK,cAGhB,SAAYK,GACRV,KAAKK,SAAWK,EAChBV,KAAKW,0CAGTb,EAAAU,UAAAI,gBAAA,WACIZ,KAAKa,YACLb,KAAKc,aAAc,GAGvBhB,EAAAU,UAAAO,cAAA,SAAcC,GACV,GAAIhB,KAAKiB,MAAO,CACZ,IAAIC,EAAUlB,KAAKiB,MAAME,kBAAkBH,GACvCI,EAAUpB,KAAKiB,MAAMI,kBAAkBL,GACvCE,GAAWA,EAAQ,IAAME,GACzBpB,KAAKG,aAAamB,KAAK,CAACC,cAAeP,EAAOE,QAASA,EAAQ,GAAIE,QAASA,MAKxFtB,EAAAU,UAAAK,UAAA,WACI,IAAIW,EAAOxB,KAAKyB,SAAS,GACzBD,EAAKtB,WAAaF,KAAKE,WAGnBsB,EAAKtB,aAAaF,KAAK0B,QAAQ1B,KAAK2B,SACpCH,EAAKI,qBAAsB,GAG/B5B,KAAKiB,MAAQ,IAAIY,EAAM7B,KAAKD,GAAG+B,cAAcC,SAAS,GAAGA,SAAS,GAAI,CAClEC,KAAMhC,KAAKgC,KACXC,KAAMjC,KAAKiC,KACXR,QAASzB,KAAKyB,QACdxB,QAASD,KAAKC,WAItBH,EAAAU,UAAA0B,UAAA,WACI,OAAOlC,KAAKD,GAAG+B,cAAcC,SAAS,GAAGA,SAAS,IAGtDjC,EAAAU,UAAA2B,eAAA,WACI,OAAOnC,KAAKiB,MAAMmB,iBAGtBtC,EAAAU,UAAA6B,eAAA,WACI,GAAIrC,KAAKiB,MACL,OAAOjB,KAAKiB,MAAMoB,kBAI1BvC,EAAAU,UAAA8B,QAAA,WACQtC,KAAKiB,OACLjB,KAAKiB,MAAMsB,UAInBzC,EAAAU,UAAAG,OAAA,WACQX,KAAKiB,QACLjB,KAAKiB,MAAMuB,UACXxC,KAAKa,cAIbf,EAAAU,UAAAiC,YAAA,WACQzC,KAAKiB,QACLjB,KAAKiB,MAAMuB,UACXxC,KAAKc,aAAc,EACnBd,KAAKiB,MAAQ,gCAnHxByB,EAAAA,UAASC,KAAA,CAAC,CACPC,SAAU,UACVC,SAAU,qVAKVC,gBAAiBC,EAAAA,wBAAwBC,OACzCC,cAAeC,EAAAA,kBAAkBC,kDAZVC,EAAAA,4CAgBtBC,EAAAA,uBAEAA,EAAAA,qBAEAA,EAAAA,sBAEAA,EAAAA,0BAEAA,EAAAA,4BAEAC,EAAAA,qBAYAD,EAAAA,uBASAA,EAAAA,eAkFL,iCALCE,EAAAA,SAAQZ,KAAA,CAAC,CACNa,QAAS,CAACC,EAAAA,cACVC,QAAS,CAAC5D,GACV6D,aAAc,CAAC7D","sourcesContent":["import {NgModule,Component,ElementRef,AfterViewInit,OnDestroy,Input,Output,EventEmitter,ChangeDetectionStrategy, ViewEncapsulation} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\nimport * as Chart from 'chart.js';\r\n\r\n@Component({\r\n    selector: 'p-chart',\r\n    template: `\r\n        <div style=\"position:relative\" [style.width]=\"responsive && !width ? null : width\" [style.height]=\"responsive && !height ? null : height\">\r\n            <canvas [attr.width]=\"responsive && !width ? null : width\" [attr.height]=\"responsive && !height ? null : height\" (click)=\"onCanvasClick($event)\"></canvas>\r\n        </div>\r\n    `,\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class UIChart implements AfterViewInit, OnDestroy {\r\n\r\n    @Input() type: string;\r\n\r\n    @Input() plugins: any[] = [];\r\n    \r\n    @Input() width: string;\r\n    \r\n    @Input() height: string;\r\n\r\n    @Input() responsive: boolean = true;\r\n    \r\n    @Output() onDataSelect: EventEmitter<any> = new EventEmitter();\r\n\r\n    initialized: boolean;\r\n    \r\n    _data: any;\r\n\r\n    _options: any = {};\r\n\r\n    chart: any;\r\n\r\n    constructor(public el: ElementRef) {}\r\n    \r\n    @Input() get data(): any {\r\n        return this._data;\r\n    }\r\n\r\n    set data(val:any) {\r\n        this._data = val;\r\n        this.reinit();\r\n    }\r\n\r\n    @Input() get options(): any {\r\n        return this._options;\r\n    }\r\n\r\n    set options(val:any) {\r\n        this._options = val;\r\n        this.reinit();\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        this.initChart();\r\n        this.initialized = true;\r\n    }\r\n\r\n    onCanvasClick(event) {\r\n        if (this.chart) {\r\n            let element = this.chart.getElementAtEvent(event);\r\n            let dataset = this.chart.getDatasetAtEvent(event);\r\n            if (element && element[0] && dataset) {\r\n                this.onDataSelect.emit({originalEvent: event, element: element[0], dataset: dataset});\r\n            }\r\n        }\r\n    }\r\n\r\n    initChart() {\r\n        let opts = this.options||{};\r\n        opts.responsive = this.responsive;\r\n\r\n        // allows chart to resize in responsive mode\r\n        if (opts.responsive&&(this.height||this.width)) {\r\n            opts.maintainAspectRatio = false;\r\n        }\r\n\r\n        this.chart = new Chart(this.el.nativeElement.children[0].children[0], {\r\n            type: this.type,\r\n            data: this.data,\r\n            options: this.options,\r\n            plugins: this.plugins\r\n        });\r\n    }\r\n    \r\n    getCanvas() {\r\n        return this.el.nativeElement.children[0].children[0];\r\n    }\r\n    \r\n    getBase64Image() {\r\n        return this.chart.toBase64Image();\r\n    }\r\n    \r\n    generateLegend() {\r\n        if (this.chart) {\r\n            return this.chart.generateLegend();\r\n        }\r\n    }\r\n    \r\n    refresh() {\r\n        if (this.chart) {\r\n            this.chart.update();\r\n        }\r\n    }\r\n    \r\n    reinit() {\r\n        if (this.chart) {\r\n            this.chart.destroy();\r\n            this.initChart();\r\n        }\r\n    }\r\n    \r\n    ngOnDestroy() {\r\n        if (this.chart) {\r\n            this.chart.destroy();\r\n            this.initialized = false;\r\n            this.chart = null;\r\n        }\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CommonModule],\r\n    exports: [UIChart],\r\n    declarations: [UIChart]\r\n})\r\nexport class ChartModule { }\r\n"]}