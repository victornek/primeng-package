{"version":3,"sources":["../../src/app/components/defer/defer.ts"],"names":["DeferredLoader","el","renderer","viewContainer","this","onLoad","EventEmitter","prototype","ngAfterViewInit","_this","shouldLoad","load","isLoaded","documentScrollListener","listen","rect","nativeElement","getBoundingClientRect","document","documentElement","clientHeight","top","view","createEmbeddedView","template","emit","ngOnDestroy","Directive","args","selector","ElementRef","Renderer2","ViewContainerRef","Output","ContentChild","TemplateRef","NgModule","imports","CommonModule","exports","declarations"],"mappings":"gaAiBI,SAAAA,EAAmBC,EAAuBC,EAA4BC,GAAnDC,KAAAH,GAAAA,EAAuBG,KAAAF,SAAAA,EAA4BE,KAAAD,cAAAA,EAR5DC,KAAAC,OAA4B,IAAIC,EAAAA,oBAU1CN,EAAAO,UAAAC,gBAAA,WAAA,IAAAC,EAAAL,KACQA,KAAKM,cACLN,KAAKO,OAGJP,KAAKQ,aACNR,KAAKS,uBAAyBT,KAAKF,SAASY,OAAO,SAAU,UAAU,WAC/DL,EAAKC,eACLD,EAAKE,OACLF,EAAKI,yBACLJ,EAAKI,uBAAyB,WAM9Cb,EAAAO,UAAAG,WAAA,WACI,GAAIN,KAAKQ,WACL,OAAO,EAGP,IAAIG,EAAOX,KAAKH,GAAGe,cAAcC,wBAIjC,OAHiBC,SAASC,gBACCC,cAENL,EAAKM,KAIlCrB,EAAAO,UAAAI,KAAA,WACIP,KAAKkB,KAAOlB,KAAKD,cAAcoB,mBAAmBnB,KAAKoB,UACvDpB,KAAKC,OAAOoB,QAGhBzB,EAAAO,UAAAK,SAAA,WACI,OAAoB,MAAbR,KAAKkB,MAGhBtB,EAAAO,UAAAmB,YAAA,WACItB,KAAKkB,KAAO,KAERlB,KAAKS,wBACLT,KAAKS,mDAzDhBc,EAAAA,UAASC,KAAA,CAAC,CACPC,SAAU,wDALaC,EAAAA,kBACFC,EAAAA,iBAAjBC,EAAAA,oDAQHC,EAAAA,yBAEAC,EAAAA,aAAYN,KAAA,CAACO,EAAAA,sBA4DlB,iCALCC,EAAAA,SAAQR,KAAA,CAAC,CACNS,QAAS,CAACC,EAAAA,cACVC,QAAS,CAACvC,GACVwC,aAAc,CAACxC","sourcesContent":["import {NgModule,Directive,ElementRef,AfterViewInit,OnDestroy,TemplateRef,EmbeddedViewRef,\r\n        ViewContainerRef,Renderer2,EventEmitter,Output,ContentChild} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\n\r\n@Directive({\r\n    selector: '[pDefer]'\r\n})\r\nexport class DeferredLoader implements AfterViewInit,OnDestroy {\r\n        \r\n    @Output() onLoad: EventEmitter<any> = new EventEmitter();\r\n    \r\n    @ContentChild(TemplateRef) template: TemplateRef<any>;\r\n        \r\n    documentScrollListener: Function;\r\n    \r\n    view: EmbeddedViewRef<any>;\r\n            \r\n    constructor(public el: ElementRef, public renderer: Renderer2, public viewContainer: ViewContainerRef) {}\r\n    \r\n    ngAfterViewInit() {\r\n        if (this.shouldLoad()) {\r\n            this.load();\r\n        }\r\n        \r\n        if (!this.isLoaded()) {\r\n            this.documentScrollListener = this.renderer.listen('window', 'scroll', () => {\r\n                if (this.shouldLoad()) {\r\n                    this.load();\r\n                    this.documentScrollListener();\r\n                    this.documentScrollListener = null;\r\n                }\r\n            });\r\n        }\r\n    }\r\n    \r\n    shouldLoad(): boolean {\r\n        if (this.isLoaded()) {\r\n            return false;\r\n        }\r\n        else {\r\n            let rect = this.el.nativeElement.getBoundingClientRect();\r\n            let docElement = document.documentElement;\r\n            let winHeight = docElement.clientHeight;\r\n            \r\n            return (winHeight >= rect.top);\r\n        }\r\n    }\r\n    \r\n    load(): void { \r\n        this.view = this.viewContainer.createEmbeddedView(this.template);\r\n        this.onLoad.emit();\r\n    }\r\n    \r\n    isLoaded() {\r\n        return this.view != null;\r\n    }\r\n            \r\n    ngOnDestroy() {\r\n        this.view = null;\r\n        \r\n        if (this.documentScrollListener) {\r\n            this.documentScrollListener();\r\n        }\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CommonModule],\r\n    exports: [DeferredLoader],\r\n    declarations: [DeferredLoader]\r\n})\r\nexport class DeferModule { }"]}